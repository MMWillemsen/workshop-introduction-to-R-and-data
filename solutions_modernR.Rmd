---
title: "Modern R with tidyverse [Solutions]"
author: "Jonathan de Bruin & Barbara Vreede"
output: 
  html_document:
    toc: true
---

*This document is part of the workshop **Introduction to R & Data** by Utrecht University RDM Support. *

```{r} 
library(tidyverse) 
```

# 1. Read and save data

### Basic exercise I - Read data files with Rstudio

#### a) Read the dataset `menus.csv`

```{r error=TRUE}
filepath <- file.path('data', 'menus.csv')
data_menus <- read_csv(filepath)

head(data_menus)
```

#### b) Load `readxl`


```{r error=TRUE}
library("readxl")
```

#### c) Read the restaurants dataset

```{r error=TRUE}

filepath <- file.path('data', 'restaurants.xlsx')
data_restaurants <- read_excel(filepath)

head(data_restaurants)
```


### Basic exercise II - Dataset properties 

```{r error=TRUE}

glimpse(data_restaurants)
glimpse(data_menus)
```

### Reading exercise - `readr` versus base R


### Optional exercise (+) - Save data to a CSV file. 

```{r error=TRUE}

write_delim(data_menus, "menus_in_csv_format.csv", delim = ";")
```

### Optional exercise (++) - Read SPSS, SAS and Excel data files

```{r}
library("haven") # to read and write SPSS, STATA and SAS files
library("readxl") # to read Excel files
```

#### a) Write data frame to SPSS, SAS, STATA data files. 

```{r}

# create a directory
if (!dir.exists('tmp')){
  dir.create("tmp")
}

# read and write files
write_sav(data_restaurants, file.path("tmp", "restaurants_spss.sav"))
data_restaurants_spss <- read_sav(file.path("tmp", "restaurants_spss.sav"))

write_sas(data_restaurants_spss, file.path("tmp", "restaurants_sas.sas7bdat"))
data_restaurants_sas <- read_sas(file.path("tmp", "restaurants_sas.sas7bdat"))

write_dta(data_restaurants_sas, file.path("tmp", "restaurants_stata.dta"))
data_restaurants_stata <- read_dta(file.path("tmp", "restaurants_stata.dta"))

head(data_restaurants_stata)

```


#### b) Write data frame to Excel. 

This is not possible with `tidyverse` at the moment. `readxl` only support Excel file reading. This is not a problem for a researcher, because we don't use Excel, isn't it?


# 2. Data visualisation

Visualizing data is important get a feeling for data sets. In the pizza dataset, visualisation is used to explore the values of the columns. Base R has strong plotting functions. To get even better flexibility in plotting, we use the ggplot2 functions `qplot` and `ggplot`. 

### Exercise 2.1 - Required - Quick plots of the menus

#### 2.1a) Single column plots

Make a quick plot of each column in the menus dataset.
```{r error=TRUE}

qplot(data_menus$menus.amountMax)

### enter your code here ###

```
#### 2.1b) Combine columns in plots

Make a quick plot of two columns in the restaurants dataset.

```{r error=TRUE}

qplot(data_restaurants$priceRangeMin, data_restaurants$priceRangeMax)

### enter your code here ###

```


### Exercise 2.1 - Required - Use ggplot 

#### 2.1a) Single column plots


### Exercise 2.3 - Reading exercise - Quick plots of the menus

### Reading Exercise - Add statistical layers to graphs.

Applying statistics

```{r echo=FALSE, message=FALSE, width=4, height=3}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() + geom_smooth()
```


Read [Chapter 3.6](https://r4ds.had.co.nz/data-visualisation.html#geometric-objects)  of [R for Data
Science](http://r4ds.had.co.nz/) and experiment with the function `geom_smooth()`. 

```{r error=TRUE}

# check ?geom_smooth for examples

```


### Exercise 2.2 - Optional (++) - Plot the restaurants on a map

In this exercise, the data is plotted on a map of the USA.

#### 2.2a) Install package the `maps`

Install the package `maps` and load the library (both by using code).

```{r}

### enter your code here ###

```

#### 2.2b) Plot the restaurants on the map of the USA.

Add a layer with the location of the restaurants.

```{r error=TRUE}
usa <- map_data("usa") 

ggplot(data_restaurants) + 
  geom_polygon(data = usa, aes(x=long, y = lat))

```


#### 2.2c) Use the maximum price to colour the restaurants.


# 3. Data transformation

Most of the time, the data is not in the shape you prefer. In this section, the transform the data about the pizza restaurants.

### Exercise 3.1 - Required - Subset data

#### 3.1a) Make a selection of all restaurants in 'Los Angeles'.

Make use of the tidyverse (dplyr) function `filter()`.

```{r error=TRUE}

### enter your code here ###

```

#### 3.1b) Make a selection of all restaurants in 'Los Angeles' where the variable `priceRangeMin` isn't missing.

*Tip: Use the function `is.na()` preceded by the `!`. Check the help page for both `is.na` and `!`.*

```{r error=TRUE}

### enter your code here ###

```

#### 3.1c) Make a selection of all restaurants in 'Los Angeles' where the variable `priceRangeMin` is not missing. Return only the `address` and `name` of the restaurants. 

Make only use of tidyverse functions.

```{r error=TRUE}

### enter your code here ###

```

### Exercise 3.2 - Required - Mutate data

The function `mutate()` is a very powerfull function in tidyverse (dplyr) to mutate column variables in a data frame or tibble. Create a new variable named `priceRangeDiff` which is the maximum price of a pizza minus the minimum price of a pizza.

```{r error=TRUE}

data_restaurants <- mutate( ### enter your code here ### )

```


### Exercise 3.3 - Optional (+) - Exclude variables

Create a tibble of the restaurant dataset without the latitude and longitude. 

Use only one line of code and less than 75 characters. 

```{r}

### enter your code here ###

```

### Exercise 3.4 - Optional (++) - Summarise results

The function `summarise()` can be used to summarise results. Compute the mean minumum price and the mean maximum price of the pizzas. Compute the median difference between the minimum and maximum price.

*Tip: Use the cheatsheet or R4DS

```{r}

### enter your code here ###

```

### Exercise 3.4 - Optional (+++) - Pipe operator



### Exercise 3.5 - Required - Join datasets

Quickly read [13.4.1](https://r4ds.had.co.nz/relational-data.html#understanding-joins)-[13.4.3](https://r4ds.had.co.nz/relational-data.html#outer-join) from R for Data Science. Focus on the images.

In this exercise, append restaurant data to each pizza. What kind of join is this? *Hint: Check the data transformation cheatsheet, section 'Combine Tables'.*

The join key in our dataset is `id`. 


```{r error=TRUE}

data_pizza_with_restaurant <- ..._join(### enter your code here ###)

```


