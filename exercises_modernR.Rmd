---
title: "Modern R with tidyverse"
author: "[Insert your name]"
output: 
  html_document:
    toc: true
---

*This document is part of the workshop **Introduction to R & Data** by Utrecht University RDM Support. *

# Introduction

In this document, we explore a list of over 3,500 pizzas from multiple restaurants in the U.S. The dataset is provided by [Datafiniti's Business Database](https://www.kaggle.com/datafiniti/pizza-restaurants-and-the-pizza-they-sell/home). Datafiniti's Business Database provides business and product information. The data we will explore in this document contains variables like the category, name, address, city, state, menu information and price range for each pizza restaurant. 

## Research questions

Research questions can be:

- *How many pizza restaurants does each state in the U.S. have?*
- *What is the median price of a large plain pizza across the U.S.?*
- ...

The exercises in this document help you aswer the research questions. You can use the structure of this document to make your own reproducible scientific analyses.

## Excercises

This part of the workshop (part II) makes use of exercises to find answers to the research questions. The excercises are divided in two groups:

- **required exercises (RE)** The solution of these exercises are part of the rest of this workshop. The code for these exercises needs to work correctly. Ask questions if you are completely stuck.

- **optional exercises (OE)** These questions might be relevant for you. Please pick a few of these exercises to enhance your skills. It doesn't matter if you do not have time to complete them all. 

## Technical requirements

This project depends on the `tidyverse` package. Load tidyverse into your work environment. 

```{r} 
library(tidyverse) 
```

# 1. Read and save data

The data about the pizza restaurants is stored in two files. One file contains the information about the restaurants while the other file contains information about the pizza's they sell.

### Exercise 1.1 - Required - Download the data

Download the data and store the data files into the data folder. 


### Exercise 1.2 - Required - Read data files with Rstudio

#### 1.2a) Read the dataset `restaurants.csv`

Complete the code in the code cell below to read the data into `data_restaurants.csv`. *Tip: Use `head(data_restaurants)` to display the result.*

```{r error=TRUE}
filepath <- file.path('data', 'restaurants.csv')
data_restaurants <- ### enter your code here ###


```

#### 1.2b) Install the `readxl`

The package `readxl` is a tidyverse package to read Excel files. Use the code below to load the package. 

```{r error=TRUE}
library() ### insert your code between the brackets ###
```

#### 1.2c) Read the dataset `menus.xlsx`

Complete the code in the code cell below to read the data into `data_restaurants.csv`. *Tip: Write `?read_excel` in your console.*

```{r error=TRUE}

filepath <- file.path('data', 'menus.xlsx')
data_menus <- ### enter your code here ###


```


### Exercise 1.3 - Required - Dataset properties 

Output the structure of the restaurants and menus dataset. Do this with the function `glimpse`. What does `<chr>`, `<dbl>` and `<int>` mean?

```{r error=TRUE}

glimpse(data_restaurants)
### enter your code here ###

```

### Exercise 1.3 - Optional (+) - Save to a CSV file. 

Save the tibble `data_menus` as a `.csv` file. Use ';' as delimiter. 

*Tip: check the function `write_delim`.

```{r error=TRUE}

### enter your code here ###

```

### Execise 1.4 - Optional (+) - Tibbles versus data.frame objects.

The `data_restaurants` is a tibble, but how do you check this with code?

Use your console to convert `data_restaurants` to a data frame. The code to do this is `as.data.frame(data_restaurants)`. 

What is the difference between outputting `data_restaurants` as a tibble or as a data frame?

### Exercise 1.5 - Reading Exercise - `readr` versus base R

You might wonder why weâ€™re not using base R functions for (flat) file reading like `read.csv()`, `read.csv2()` and `read.delimiter()`. These function are available by default in base R and don't require additional packages like `readr`. 

Read [Chapter 11.2.1](http://r4ds.had.co.nz/data-import.html#compared-to-base-r)  of [R for Data
Science](http://r4ds.had.co.nz/) and think about the topics like reproducibility, shareablitiy and performance. Discuss your thoughts with another workshop participant.


### Exercise 1.6 - Optional (++) - Read SPSS, SAS and Excel data files

By default, it is not possible to read SPSS, SAS and Excel files with R. Tidyverse offers some packages to make this possible. These packages are loaded and attached by default when  `library(tidyverse)` is called. Install the packages `haven` and `readxl`. Load the packages with the following lines of code:

```{r}
library("haven") # to read and write SPSS, STATA and SAS files
library("readxl") # to read Excel files
```

#### 1.6a) Write data frame to SPSS, SAS, STATA data files. 

Do the following: 

- Write the `data_restaurants` to a SPSS (`.dat`) file
- Read the saved SPSS data file. 
- Write the result of the previous step 

`Create a code block here and insert the required code.`

#### 1.6b) Write data frame to Excel. 

Write `data_restaurants` to an Excel file. 

Is there a tidyverse function to do this? If not, read on the internet about
writing Excel files with R.


# 2. Data visualisation

Visualizing data is important get a feeling for data sets. In the pizza dataset, visualisation is used to explore the values of the columns. Base R has strong plotting functions. To get even better flexibility in plotting, we use the ggplot2 functions `qplot` and `ggplot`. 

### Exercise 2.1 - Required - Quick plots of the menus

#### 2.1a) Single column plots

Make a quick plot of each column in the menus dataset.
```{r error=TRUE}

qplot(data_menus$menus.amountMax)

### enter your code here ###

```
#### 2.1b) Combine columns in plots

Make a quick plot of two columns in the restaurants dataset.

```{r error=TRUE}

qplot(data_restaurants$priceRangeMin, data_restaurants$priceRangeMax)

### enter your code here ###

```


### Exercise 2.1 - Required - Use ggplot 

#### 2.1a) Single column plots


### Exercise 2.3 - Reading exercise - Quick plots of the menus


### Exercise 2.2 - Optional (++) - Plot the restaurants on a map

In this exercise, the data is plotted on a map of the USA.

#### 2.2a) Install package the `maps`

Install the package `maps` and load the library (both by using code).

```{r}

### enter your code here ###

```

#### 2.2b) Plot the restaurants on the map of the USA.

Add a layer with the location of the restaurants.

```{r error=TRUE}
usa <- map_data("usa") 

ggplot(data_restaurants) + 
  geom_polygon(data = usa, aes(x=long, y = lat))

```


#### 2.2c) Use the maximum price to colour the restaurants.


### Exercise 2.3 - Reading Exercise - Add statistical layers to graphs.

Applying statistics

```{r echo=FALSE, message=FALSE, width=4, height=3}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() + geom_smooth()
```


Read [Chapter 3.6](https://r4ds.had.co.nz/data-visualisation.html#geometric-objects)  of [R for Data
Science](http://r4ds.had.co.nz/) and experiment with the function `geom_smooth()`. 

```{r error=TRUE}

# check ?geom_smooth for examples

```



# 3. Data transformation

Most of the time, the data is not in the shape you prefer. In this section, the transform the data about the pizza restaurants.

### Exercise 3.1 - Required - Subset data

#### 3.1a) Make a selection of all restaurants in 'Los Angeles'.

Make use of the tidyverse (dplyr) function `filter()`.

```{r error=TRUE}

### enter your code here ###

```

#### 3.1b) Make a selection of all restaurants in 'Los Angeles' where the variable `priceRangeMin` isn't missing.

*Tip: Use the function `is.na()` preceded by the `!`. Check the help page for both `is.na` and `!`.*

```{r error=TRUE}

### enter your code here ###

```

#### 3.1c) Make a selection of all restaurants in 'Los Angeles' where the variable `priceRangeMin` is not missing. Return only the `address` and `name` of the restaurants. 

Make only use of tidyverse functions.

```{r error=TRUE}

### enter your code here ###

```

### Exercise 3.2 - Required - Mutate data

The function `mutate()` is a very powerfull function in tidyverse (dplyr) to mutate column variables in a data frame or tibble. Create a new variable named `priceRangeDiff` which is the maximum price of a pizza minus the minimum price of a pizza.

```{r error=TRUE}

data_restaurants <- mutate( ### enter your code here ### )

```


### Exercise 3.3 - Optional (+) - Exclude variables

Create a tibble of the restaurant dataset without the latitude and longitude. 

Use only one line of code and less than 75 characters. 

```{r}

### enter your code here ###

```

### Exercise 3.4 - Optional (++) - Summarise results

The function `summarise()` can be used to summarise results. Compute the mean minumum price and the mean maximum price of the pizzas. Compute the median difference between the minimum and maximum price.

*Tip: Use the cheatsheet or R4DS

```{r}

### enter your code here ###

```

### Exercise 3.4 - Optional (+++) - Pipe operator



### Exercise 3.5 - Required - Join datasets

Quickly read [13.4.1](https://r4ds.had.co.nz/relational-data.html#understanding-joins)-[13.4.3](https://r4ds.had.co.nz/relational-data.html#outer-join) from R for Data Science. Focus on the images.

In this exercise, append restaurant data to each pizza. What kind of join is this? *Hint: Check the data transformation cheatsheet, section 'Combine Tables'.*

The join key in our dataset is `id`. 


```{r error=TRUE}

data_pizza_with_restaurant <- ..._join(### enter your code here ###)

```


